name: Build Backpack Build Action

on:
  push:
    branches:
      - '*'         # matches every branch that doesn't contain a '/'
      - '*/*'       # matches every branch containing a single '/'
      - '**'        # matches every branch
      - '!main'   # excludes master

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install AWS CLI
        run: |
#          curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
          curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.14.5.zip" -o "awscliv2.zip"
          unzip awscliv2.zip
          sudo ./aws/install --install-dir .awscli --bin-dir .custom-bin --update
               
          cp .awscli/v2/2.14.5/bin/aws custom-bin
          cp .awscli/v2/2.14.5/bin/aws_completer custom-bin

      - name: Commit
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.no-reply.github.com"
          git add custom-bin/*
          git add .awscli/*
          git commit -m "Update AWS CLI"
          git push